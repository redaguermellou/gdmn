{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h4 class="mb-4 fw-bold text-dark"><i class="fas fa-history me-2 text-primary"></i>Journal d'audit</h4>
    <div class="card-modern overflow-hidden">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light-subtle">
                        <tr>
                            <th class="border-0 text-uppercase text-secondary text-xs font-weight-bolder ps-4"
                                style="font-size: 0.75rem; letter-spacing: 1px;">Date</th>
                            <th class="border-0 text-uppercase text-secondary text-xs font-weight-bolder"
                                style="font-size: 0.75rem; letter-spacing: 1px;">Dossier</th>
                            <th class="border-0 text-uppercase text-secondary text-xs font-weight-bolder"
                                style="font-size: 0.75rem; letter-spacing: 1px;">Action</th>
                            <th class="border-0 text-uppercase text-secondary text-xs font-weight-bolder"
                                style="font-size: 0.75rem; letter-spacing: 1px;">Utilisateur</th>
                            <th class="border-0 text-uppercase text-secondary text-xs font-weight-bolder"
                                style="font-size: 0.75rem; letter-spacing: 1px;">Détails</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for log in logs %}
                        <tr>
                            <td class="ps-4">
                                <div class="d-flex flex-column">
                                    <span class="text-dark fw-bold text-sm">{{ log.timestamp|date:"d M Y" }}</span>
                                    <span class="text-muted text-xs">{{ log.timestamp|date:"H:i" }}</span>
                                </div>
                            </td>
                            <td>
                                <a href="{% url 'dossier_detail' log.dossier.id %}"
                                    class="text-decoration-none fw-bold text-primary">
                                    #{{ log.dossier.reference }}
                                </a>
                            </td>
                            <td>
                                {% if log.action == 'CREATE' %}
                                <span
                                    class="badge bg-success-subtle text-success border border-success-subtle rounded-pill">Création</span>
                                {% elif log.action == 'UPDATE' %}
                                <span
                                    class="badge bg-warning-subtle text-warning border border-warning-subtle rounded-pill">Modification</span>
                                {% elif log.action == 'STATUS_CHANGE' %}
                                <span
                                    class="badge bg-info-subtle text-info border border-info-subtle rounded-pill">Statut</span>
                                {% elif log.action == 'ATTACHMENT_ADD' %}
                                <span
                                    class="badge bg-primary-subtle text-primary border border-primary-subtle rounded-pill">Pièce
                                    jointe +</span>
                                {% elif log.action == 'ATTACHMENT_REMOVE' %}
                                <span
                                    class="badge bg-danger-subtle text-danger border border-danger-subtle rounded-pill">Pièce
                                    jointe -</span>
                                {% elif log.action == 'CONTROLLER_ASSIGN' %}
                                <span
                                    class="badge bg-dark-subtle text-dark border border-dark-subtle rounded-pill">Assignation</span>
                                {% else %}
                                <span
                                    class="badge bg-secondary-subtle text-secondary border border-secondary-subtle rounded-pill">{{
                                    log.get_action_display }}</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="avatar avatar-xs me-2 bg-gradient-primary rounded-circle text-white d-flex align-items-center justify-content-center"
                                        style="width: 24px; height: 24px; font-size: 10px;">
                                        {{ log.user.full_name|slice:":1"|default:log.user.email|slice:":1"|upper }}
                                    </div>
                                    <span class="text-dark text-sm fw-medium">{{
                                        log.user.full_name|default:log.user.email }}</span>
                                </div>
                            </td>
                            <td class="text-muted text-sm">
                                <span class="d-inline-block text-truncate" style="max-width: 250px;"
                                    title="{{ log.details }}">
                                    {{ log.details|default:"-" }}
                                </span>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center py-5">
                                <div class="d-flex flex-column align-items-center">
                                    <div class="mb-3 text-muted opacity-50">
                                        <i class="fas fa-clipboard-list fa-3x"></i>
                                    </div>
                                    <h6 class="text-muted fw-normal">Aucune activité enregistrée</h6>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}